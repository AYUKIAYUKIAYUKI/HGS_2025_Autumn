//============================================================================
// 
// ゴール [goal.cpp]
// Author : 後藤優輝
// 
//============================================================================

//****************************************************
// インクルードファイル
//****************************************************
#include "goal.h"
#include "texture.manager.h"
#include "player.h"
#include"object.manager.h"
//****************************************************
// usingディレクティブ
//****************************************************
using namespace useful;

//============================================================================
// コンストラクタ
//============================================================================
CGoal::CGoal(OBJ::TYPE Type, OBJ::LAYER Layer)
	: CObject2D(Type, Layer)
{

}

//============================================================================
// デストラクタ
//============================================================================
CGoal::~CGoal()
{

}

//============================================================================
// 更新処理
//============================================================================
void CGoal::Update()
{
	CObject2D::Update();
}

//============================================================================
// 描画処理
//============================================================================
void CGoal::Draw()
{
	CObject2D::Draw();
}

//============================================================================
// 生成
//============================================================================
CGoal* CGoal::Create(D3DXVECTOR3 Pos)
{
	CGoal* p = DBG_NEW CGoal(OBJ::TYPE::GOAL, OBJ::LAYER::DEFAULT);

	//初期化処理
	p->Initialize();

	// どっかローカルに置いたパラメータ
	D3DXVECTOR3 SizeSize = { 120.0f, 120.0f, 0.0f };
	D3DXVECTOR3 Rot = { 0.0f, 0.0f, 0.0f };

	p->SetPos(Pos);//位置設定
	p->SetRot(Rot);//向き設定
	p->SetSize(SizeSize);//大きさ設定
	p->BindTex(CTextureManager::RefInstance().RefRegistry().BindAtKey("moon"));//テクスチャの設定
	return p;
}

//============================================================================
//ゴール判定
//============================================================================
bool CGoal::Judge()
{
	// プレイヤーの検索
	std::list<CObject*>ol = CObjectManager::RefInstance().RefObjList(OBJ::TYPE::PLAYER);	// プレイヤーのリストを取得
	CObject* pobj = ol.front();	// 先頭を代入
	CPlayer* pPlayer = DownCast<CPlayer, CObject>(pobj);	// ダウンキャスト

	if (pPlayer->GetPos().x >= GetPos().x - GetSize().x
		&& pPlayer->GetPos().x <= GetPos().x + GetSize().x
		&& pPlayer->GetPos().y >= GetPos().y - GetSize().y
		&& pPlayer->GetPos().y <= GetPos().y + GetSize().y)
	{
		return true;
	}

	return false;
}